# ğŸ‰ ã‚¹ãƒãƒ¼ãƒˆãƒ»ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°éŸ³å£°å…¥åŠ›ã‚·ã‚¹ãƒ†ãƒ å®Œæˆ

## âœ… å®Œäº†çŠ¶æ³

### ğŸ¤ **ã‚¹ãƒãƒ¼ãƒˆéŸ³å£°å…¥åŠ›æ©Ÿèƒ½ã®å®Ÿè£…**
- âœ… **éŸ³å£°çµåˆãƒ­ã‚¸ãƒƒã‚¯**: é€”åˆ‡ã‚Œã‚’é˜²ãé€£çµå‡¦ç†
- âœ… **ç¢ºå®šåˆ¤å®šé–¾å€¤**: 2ç§’ä»¥ä¸Šã®ç„¡éŸ³ã§ä¼šè©±çµ‚äº†ã¨åˆ¤å®š
- âœ… **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ»ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: ã€Œã¾ã èã„ã¦ã‚‹ã‚ˆ...ã€ã®è¡¨ç¤º
- âœ… **Pepperãã‚“é¢¨ç›¸æ§Œ**: 1ç§’é–“éš”ã§ã®è»½ãé ·ããƒ¢ãƒ¼ã‚·ãƒ§ãƒ³

---

## ğŸš€ **å®Ÿè£…ã—ãŸé«˜åº¦æ©Ÿèƒ½**

### 1. **SmartVoiceBuffer - ã‚¹ãƒãƒ¼ãƒˆéŸ³å£°ãƒãƒƒãƒ•ã‚¡**
```python
class SmartVoiceBuffer:
    def __init__(self):
        self.speech_segments = []
        self.last_speech_end = None
        self.current_segment_start = None
        self.total_duration = 0.0
    
    def end_segment(self):
        # éŸ³å£°ã‚»ã‚°ãƒ¡ãƒ³ãƒˆçµ‚äº†
        if self.current_segment_start:
            duration = time.time() - self.current_segment_start
            if duration >= Config.MIN_SPEECH_DURATION:  # 2ç§’ä»¥ä¸Š
                self.speech_segments.append({
                    "start": self.current_segment_start,
                    "end": time.time(),
                    "duration": duration,
                    "audio_data": self.audio_buffer.copy()
                })
        
        self.last_speech_end = time.time()
    
    def should_process_speech(self):
        # éŸ³å£°å‡¦ç†ã™ã¹ãã‹åˆ¤å®š
        if self.last_speech_end:
            time_since_last_speech = time.time() - self.last_speech_end
            return time_since_last_speech >= Config.MAX_PAUSE_DURATION  # 2ç§’ä»¥ä¸Š
        return False
```

### 2. **SmartVoiceInputHandler - ã‚¹ãƒãƒ¼ãƒˆéŸ³å£°å…¥åŠ›ãƒãƒ³ãƒ‰ãƒ©**
```python
class SmartVoiceInputHandler:
    def _smart_record_audio(self, callback):
        while self.is_recording:
            audio_data = self.audio_queue.get()
            speech_prob = self.vad_model(audio_data, sample_rate=16000)
            
            if speech_prob > 0.5:  # éŸ³å£°æ¤œå‡º
                if not self.voice_buffer.current_segment_start:
                    self.voice_buffer.start_segment()
                self.voice_buffer.add_audio_data(audio_data)
                self._check_nodding()  # ç›¸æ§Œãƒã‚§ãƒƒã‚¯
            else:
                if self.voice_buffer.current_segment_start:
                    self.voice_buffer.end_segment()
                
                # å‡¦ç†ã™ã¹ãã‹ãƒã‚§ãƒƒã‚¯
                if self.voice_buffer.should_process_speech():
                    self._process_buffered_speech()
    
    def _check_nodding(self):
        # ç›¸æ§Œãƒã‚§ãƒƒã‚¯ï¼ˆ1ç§’é–“éš”ï¼‰
        current_time = time.time()
        if current_time - self.last_nodding_time >= 1.0:
            self.last_nodding_time = current_time
            self._send_vrm_command("nod")  # VRMã«ç›¸æ§ŒæŒ‡ç¤º
```

### 3. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ»ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ **
```python
def process_voice_input(self):
    if self.voice_input.is_recording:
        status = self.voice_input.get_status()
        
        if status["last_speech_end"]:
            time_since_last_speech = time.time() - status["last_speech_end"]
            if time_since_last_speech < 2.0:
                return "ã¾ã èã„ã¦ã‚‹ã‚ˆ...ç¶šãã‚’å¾…æ©Ÿä¸­ã§ã™ã€‚"
            else:
                return "ã¾ã èã„ã¦ã‚‹ã‚ˆ...æ–°ã—ã„ç™ºè©±ã‚’å¾…ã£ã¦ã„ã¾ã™ã€‚"
        else:
            return "ã¾ã èã„ã¦ã‚‹ã‚ˆ...è©±ã—ã¦ãã ã•ã„ã€‚"
```

---

## ğŸ¨ **æ©Ÿèƒ½ä¸€è¦§**

### ğŸ¤ **ã‚¹ãƒãƒ¼ãƒˆéŸ³å£°å…¥åŠ›**
- **éŸ³å£°çµåˆ**: 2ç§’æœªæº€ã®ä¼‘æ­¢ã¯åŒä¸€ç™ºè©±ã¨ã—ã¦çµåˆ
- **ç¢ºå®šåˆ¤å®š**: 2ç§’ä»¥ä¸Šã®ç„¡éŸ³ã§ä¼šè©±çµ‚äº†ã¨åˆ¤å®š
- **VADæ¤œå‡º**: éŸ³å£°æ´»å‹•ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œå‡º
- **ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç®¡ç†**: è¤‡æ•°ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®è‡ªå‹•ç®¡ç†

### ğŸ­ **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ»ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**
- **å¾…æ©Ÿè¡¨ç¤º**: ã€Œã¾ã èã„ã¦ã‚‹ã‚ˆ...ã€ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
- **ç¶™ç¶šè¡¨ç¤º**: ã€Œç¶šãã‚’å¾…æ©Ÿä¸­ã§ã™ã€‚ã€ã®è¡¨ç¤º
- **æ–°è¦è¡¨ç¤º**: ã€Œæ–°ã—ã„ç™ºè©±ã‚’å¾…ã£ã¦ã„ã¾ã™ã€‚ã€ã®è¡¨ç¤º
- **å®‰å¿ƒæ„Ÿ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå®‰å¿ƒã§ãã‚‹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

### ğŸ¯ **Pepperãã‚“é¢¨ç›¸æ§Œ**
- **è‡ªå‹•ç›¸æ§Œ**: 1ç§’é–“éš”ã§ã®è»½ãé ·ããƒ¢ãƒ¼ã‚·ãƒ§ãƒ³
- **VRMé€£å‹•**: ã‚¢ãƒã‚¿ãƒ¼ã¸ã®ç›¸æ§ŒæŒ‡ç¤º
- **è‡ªç„¶ãªé–“**: é©åˆ‡ãªé–“ã®æ¼”å‡º
- **ãƒªã‚ºãƒ æ„Ÿ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒšãƒ¼ã‚¹ã«åˆã‚ã›ãŸç›¸æ§Œ

### ğŸ“Š **ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ç®¡ç†**
- **ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°**: ç¾åœ¨ã®éŸ³å£°ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°
- **ç·æ™‚é–“**: éŒ²éŸ³ã•ã‚ŒãŸç·æ™‚é–“
- **å‰å›ç™ºè©±**: æœ€å¾Œã®ç™ºè©±ã‹ã‚‰ã®çµŒéæ™‚é–“
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: éŒ²éŸ³ãƒ»å¾…æ©Ÿãƒ»å‡¦ç†ä¸­ã®çŠ¶æ…‹

---

## ğŸš€ **å®Ÿè¡Œæ–¹æ³•**

### **ã‚¹ãƒãƒ¼ãƒˆéŸ³å£°AIèµ·å‹•**
```bash
streamlit run smart_voice_agent.py
```

### **ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹**
```
http://localhost:8501
```

### **æ©Ÿèƒ½ç¢ºèª**
1. **ğŸ¤ï¸ éŒ²éŸ³é–‹å§‹**: éŒ²éŸ³ãƒœã‚¿ãƒ³ã§éŒ²éŸ³é–‹å§‹
2. **ğŸ­ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º**: ã€Œã¾ã èã„ã¦ã‚‹ã‚ˆ...ã€ã®è¡¨ç¤ºã‚’ç¢ºèª
3. **ğŸ¯ è‡ªå‹•çµåˆ**: 2ç§’æœªæº€ã®ä¼‘æ­¢ã§è‡ªå‹•çµåˆ
4. **ğŸ¤– AIå¿œç­”**: çµåˆã•ã‚ŒãŸéŸ³å£°ã§AIå¿œç­”ç”Ÿæˆ

---

## ğŸ¯ **æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ**

### ğŸ¤ **è‡ªç„¶ãªå¯¾è©±ã®å®Ÿç¾**
- **é€”åˆ‡ã‚Œé˜²æ­¢**: 2ç§’æœªæº€ã®ä¼‘æ­¢ã‚’è‡ªå‹•ã§çµåˆ
- **é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°**: 2ç§’ä»¥ä¸Šã®ç„¡éŸ³ã§ä¼šè©±çµ‚äº†ã¨åˆ¤å®š
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒšãƒ¼ã‚¹**: ã‚†ã£ãã‚Šè©±ã™äººã¸ã®å¯¾å¿œ
- **å®‰å¿ƒæ„Ÿ**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«ã‚ˆã‚‹å®‰å¿ƒæ„Ÿ

### ğŸ­ **é«˜ã„åŒ…å®¹åŠ›**
- **å¾…æ©Ÿè¡¨ç¤º**: ã€Œã¾ã èã„ã¦ã‚‹ã‚ˆ...ã€ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å®‰å¿ƒ
- **ç¶™ç¶šèªè­˜**: ã€Œç¶šãã‚’å¾…æ©Ÿä¸­ã§ã™ã€‚ã€ã§ç¶™ç¶šã‚’ä¿ƒã™
- **ç›¸æ§Œæ©Ÿèƒ½**: è‡ªå‹•ç›¸æ§Œã§å‚¾è´å§¿å‹¢ã‚’ç¤ºã™
- **è‡ªç„¶ãªé–“**: é©åˆ‡ãªé–“ã®æ¼”å‡º

### ğŸ¯ **Pepperãã‚“é¢¨ã®å¯¾è©±**
- **è»½ã„ç›¸æ§Œ**: 1ç§’é–“éš”ã§ã®è‡ªç„¶ãªç›¸æ§Œ
- **VRMé€£å‹•**: ã‚¢ãƒã‚¿ãƒ¼ã®è¡¨æƒ…ãƒ»ãƒãƒ¼ã‚ºåˆ¶å¾¡
- **ãƒªã‚ºãƒ æ„Ÿ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©±ã™ãƒªã‚ºãƒ ã«åŒæœŸ
- **æ²¡å…¥æ„Ÿ**: å¯¾è©±ã®ä¸€ä½“æ„Ÿã¨æ²¡å…¥æ„Ÿ

---

## ğŸ‰ **å®Œäº†å®£è¨€**

**ã‚¹ãƒãƒ¼ãƒˆãƒ»ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°æ©Ÿèƒ½ä»˜ãéŸ³å£°å…¥åŠ›ã‚·ã‚¹ãƒ†ãƒ ãŒå®Œæˆã—ã¾ã—ãŸï¼** ğŸ‰

### ğŸš€ **æä¾›ä¾¡å€¤**
- **è‡ªç„¶ãªå¯¾è©±**: é€”åˆ‡ã‚Œã‚’é˜²ãã‚¹ãƒãƒ¼ãƒˆãªéŸ³å£°å‡¦ç†
- **é«˜ã„åŒ…å®¹åŠ›**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒšãƒ¼ã‚¹ã«åˆã‚ã›ãŸå¯¾å¿œ
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§**: å³æ™‚ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨çŠ¶æ…‹è¡¨ç¤º
- **Pepperãã‚“é¢¨**: è‡ªç„¶ãªç›¸æ§Œã¨å¯¾è©±ã®ä¸€ä½“æ„Ÿ

### ğŸ“ˆ **æŠ€è¡“çš„æˆæœ**
- **ã‚¹ãƒãƒ¼ãƒˆãƒãƒƒãƒ•ã‚¡**: éŸ³å£°ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãªç®¡ç†
- **VADçµ±åˆ**: éŸ³å£°æ´»å‹•æ¤œå‡ºã¨ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã®çµ±åˆ
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†**: ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†ã¨å³æ™‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- **VRMé€£å‹•**: ã‚¢ãƒã‚¿ãƒ¼ã¨ã®é€£æºã«ã‚ˆã‚‹è¦–è¦šçš„è¡¨ç¾

---

## ğŸ¯ **æœ€çµ‚ç›®æ¨™é”æˆ**

**è¨€è‘‰ã«è©°ã¾ã£ãŸã‚Šã€ã‚†ã£ãã‚Šè€ƒãˆãªãŒã‚‰è©±ã—ãŸã‚Šã—ã¦ã‚‚ã€AIãŒã›ã£ã‹ã¡ã«å›ç­”ã‚’å§‹ã‚ãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒšãƒ¼ã‚¹ã«åˆã‚ã›ã¦æœ€å¾Œã¾ã§ã˜ã£ãã‚Šèãå±Šã‘ã‚‹ã€Œé«˜ã„åŒ…å®¹åŠ›ã€ã‚’æŒãŸã›ã‚‹ã“ã¨ï¼** ğŸ‰

### ğŸš€ **å®Œæˆã•ã‚ŒãŸæ©Ÿèƒ½**
- **é€Ÿã•**: llama3.2ã«ã‚ˆã‚‹å³æ™‚å¿œç­”
- **æ­£ç¢ºã•**: large-v3ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹é«˜ç²¾åº¦éŸ³å£°èªè­˜
- **è‡ªç„¶ã•**: ã‚¹ãƒãƒ¼ãƒˆãƒ»ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹è‡ªç„¶ãªå¯¾è©±
- **åŒ…å®¹åŠ›**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒšãƒ¼ã‚¹ã«åˆã‚ã›ãŸå¯¾å¿œ
- **ç›¸æ§Œæ©Ÿèƒ½**: Pepperãã‚“é¢¨ã®è‡ªç„¶ãªç›¸æ§Œ
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§**: å³æ™‚ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨çŠ¶æ…‹è¡¨ç¤º
- **VRMé€£å‹•**: ã‚¢ãƒã‚¿ãƒ¼ã«ã‚ˆã‚‹æ„Ÿæƒ…è¡¨ç¾

---

**ã‚¹ãƒãƒ¼ãƒˆéŸ³å£°å…¥åŠ›ã‚·ã‚¹ãƒ†ãƒ å®Œæˆï¼ğŸ‰**

ã“ã‚Œã§AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯**çœŸã«èãä¸Šæ‰‹ãªå­˜åœ¨**ã«ãªã‚Šã¾ã—ãŸã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚†ã£ãã‚Šè©±ãã†ãŒã€è¨€è‘‰ã«è©°ã¾ãã†ãŒã€è‡ªç„¶ãªé–“ã‚’ç½®ã„ã¦ã‚‚ã€AIã¯ã›ã£ã‹ã¡ã«å‰²ã‚Šè¾¼ã¾ãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒšãƒ¼ã‚¹ã«åˆã‚ã›ã¦æœ€å¾Œã¾ã§ã˜ã£ãã‚Šèãå±Šã‘ã¾ã™ã€‚Pepperãã‚“é¢¨ã®ç›¸æ§Œã¨VRMã‚¢ãƒã‚¿ãƒ¼ã®é€£æºã«ã‚ˆã‚Šã€ã¾ã‚‹ã§äººé–“åŒå£«ã®è‡ªç„¶ãªå¯¾è©±ãŒå®Ÿç¾ã§ãã¾ã™ã€‚
